package Variablen;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

import org.bukkit.Bukkit;
import org.bukkit.Location;
import org.bukkit.configuration.serialization.ConfigurationSerializable;
import org.bukkit.entity.Player;

import Variablen.SLocation;

public class Area implements ConfigurationSerializable {


	@SuppressWarnings("unused")
	private static final long serialVersionUID = -3069561910579589467L;
	static SLocation l1;
	static SLocation l2;
	
	transient static ArrayList<String> playersInArea = new ArrayList<String>();
	

	
	public static void Area(Location l1, Location l2){
		Area.l1 = new SLocation(l1);
		Area.l2 = new SLocation(l2);
	}
	
	public Location[] getLocations(){
		return new Location[]{(Location) l1.getNormal(),(Location) l2.getNormal()};
	}
	
	public boolean isInArea(Location l){
		Location s1 = (Location) l1.getNormal();
		Location s2 = (Location) l2.getNormal();
		int minx = Math.min(s1.getBlockX(), s2.getBlockX());
		int miny = Math.min(s1.getBlockY(), s2.getBlockY());
		int minz = Math.min(s1.getBlockZ(), s2.getBlockZ());
		int maxx = Math.max(s1.getBlockX(), s2.getBlockX());
		int maxy = Math.max(s1.getBlockY(), s2.getBlockY());
		int maxz = Math.max(s1.getBlockZ(), s2.getBlockZ());
		if(minx<l.getBlockX()&&l.getBlockX()<maxx){
			if(miny<l.getBlockY()&&l.getBlockY()<maxy){
				if(minz<l.getBlockZ()&&l.getBlockZ()<maxz){
					return true;
				}
			}
		}
		return false;
	}
	
	public static void checkForPlayersInArea(){
		playersInArea.clear();
		for(Player p : Bukkit.getOnlinePlayers()){
			Location loc = p.getLocation();
			Location l1 = Area.l1.unpack();
			Location l2 = Area.l2.unpack();
			if(loc.getWorld().getName()==l1.getWorld().getName()){
				double x1 = Math.min(l1.getX(), l2.getX());
				double y1 = Math.min(l1.getY(), l2.getY());
				double z1 = Math.min(l1.getZ(), l2.getZ());
				double x2 = Math.max(l1.getX(), l2.getX());
				double y2 = Math.max(l1.getY(), l2.getY());
				double z2 = Math.max(l1.getZ(), l2.getZ());
				
				double x = loc.getX();
				double y = loc.getY();
				double z = loc.getZ();
				
				if(x>=x1&&x<=x2){
					if(y>=y1&&y<=y2){
						if(z>=z1&&z<=z2){
							playersInArea.add(p.getName());
						}
					}
				}
				
			}
		}
	}
	
	@Override
	public Map<String, Object> serialize() {
		HashMap<String, Object> area = new HashMap<String, Object>();
		area.put("location.1",l1);
		area.put("location.2", l2);
		return area;
	}
	
	public static boolean isPlayerInArea(String player){
		return playersInArea.contains(player);
	}
	
	public ArrayList<String> getPlayersInArea(){
		return playersInArea;
	}
	
}
